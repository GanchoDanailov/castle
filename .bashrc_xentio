# .bashrc

# Source global definitions
if [ -f /etc/bashrc ]; then
	. /etc/bashrc
fi

# Uncomment the following line if you don't like systemctl's auto-paging feature:
# export SYSTEMD_PAGER=

if [ -f ~/.bash_aliases ]; then
    . ~/.bash_aliases
fi

if [ -f ~/.env_variables ]; then
    . ~/.env_variables
fi

export PATH="$PATH:$HOME/.rvm/bin" # Add RVM to PATH for scripting


#
# is this an interactive session?
#
[[ -z "${PS1}" ]] && return


#
# prompt string made the nice way
#
prompt_command() {
## hostname
local host=${HOSTNAME%.local}

## colors
local reset='\[\033[00m\]'
local grey='\[\033[01;30m\]'
local red='\[\033[01;31m\]'
local green='\[\033[01;32m\]'
local yellow='\[\033[01;33m\]'
local blue='\[\033[01;34m\]'
local pink='\[\033[01;35m\]'
local cyan='\[\033[00;36m\]'

## nifty current directory
local pwd=${PWD/$HOME/\~}
if [[ $pwd = /home/* ]]; then
pwd=\~${pwd#/home/}
fi

## git/svn status, ruby rvm gemset, python virtualenv
local git=
local svn=
local rgs=
local pve=
local dir=${PWD}

if [[ ${dir} != ${HOME} ]]; then
while [[ ! -d ${dir}/.git && ${dir} != '/' && -n ${dir} ]]; do
dir=${dir%/*}
done

if [[ -n ${dir} && -z ${BASHRC_DISABLE_GIT} ]]; then
local branch=`git symbolic-ref HEAD 2>/dev/null`
branch=${branch#refs/heads/}
if [[ -n ${branch} ]]; then
local status=`git status --porcelain 2>/dev/null`
if [[ -n ${status} ]]; then
git="${reset}(${grey}git:${red}${branch}${reset})"
else
git="${reset}(${grey}git:${green}${branch}${reset})"
fi
fi
fi

if [[ -z ${git} && -z ${BASHRC_DISABLE_SVN} ]]; then
dir=${PWD}
while [[ ! -d ${dir}/.svn && ${dir} != '/' && -n ${dir} ]]; do
dir=${dir%/*}
done

if [[ -n ${dir} ]]; then
local revision=`svn info 2>/dev/null|grep Revision:|cut -d' ' -f2`
if [[ -n ${revision} ]]; then
#svn="${reset}(${grey}svn:${blue}r${revision}${reset})"
local status=`svn status 2>/dev/null|head -1`
if [[ -n ${status} ]]; then
svn="${reset}(${grey}svn:${red}r${revision}${reset})"
else
svn="${reset}(${grey}svn:${green}r${revision}${reset})"
fi
fi
fi
fi

if [[ -z ${BASHRC_DISABLE_RVM_GEMSET} && -n ${GEM_HOME} && ${GEM_HOME} = *${rvm_gemset_separator:-'@'}* ]]; then
rgs="${reset}{${grey}env:${cyan}${GEM_HOME##*@}${reset}}"
fi

if [[ -z ${BASHRC_DISABLE_VIRTUALENV} && -n ${VIRTUAL_ENV} ]]; then
pve="${reset}{${grey}env:${cyan}${VIRTUAL_ENV##*/}${reset}}"
fi
fi

PS1="${reset}[${green}${USER}${reset}@${blue}${host}${reset}(${yellow}${pwd}${git}${svn}${rgs}${pve}${reset})]\\$ "
}

PS1="\u@\h:\w\\$ "
PROMPT_COMMAND=prompt_command

[[ -s "${HOME}/.rvm/scripts/rvm" ]]			&& . "${HOME}/.rvm/scripts/rvm"
[[ -r "${HOME}/.rvm/scripts/completion" ]]	&& . "${HOME}/.rvm/scripts/completion"
